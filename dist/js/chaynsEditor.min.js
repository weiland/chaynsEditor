var chaynsEditor=function(e,t,n){"use strict";function a(e){k.isChaynsEnvironment()&&(e||k.isAdmin())?(t.head.appendChild(x.createDomElement("link",{href:"//chayns1.tobit.com/SlitteRessource/ChaynsEditor/css/chaynsEditor.css",rel:"stylesheet",type:"text/css"},n)),b=x.createToolbar(),o(),t.addEventListener("mousedown",c)):console.error("Error initializing chaynsEditor.")}function o(){[].forEach.call(t.querySelectorAll("[data-lang]"),function(e){e.addEventListener("click",r)})}function r(e){var t=k.getEditableParent(e.target||e.srcElement);t!==C&&e.ctrlKey&&(C&&f(C),d(t))}function l(e){e.addEventListener("keyup",s)}function i(e){e.removeEventListener("keyup")}function s(e){var n=e.target||e.srcElement;v=n.innerHTML.trim()!=L.content.trim(),t.querySelector("#save-button").style.display=v?"inline-block":"none"}function c(e){var t=e.target||e.srcElement;!C||t.isContentEditable||t===b||k.isChildOf(b,t)||(v&&(E&&g(),k.confirmAndCall("Willst Du die &Auml;nderungen speichern?",h,p)),f(C))}function u(e){L.content=e.innerHTML,L.backgroundColor=e.style.backgroundColor,L.color=e.style.color}function d(e){C||(x.setToolbarPosition(e),k.addToolbarMargin(e),t.body.appendChild(b),t.querySelector("#save-button").style.display="none",C=e,u(e),l(e),m(!0))}function f(e){C&&(k.removeToolbarMargin(e),t.body.removeChild(b),m(!1),i(e),C=null)}function m(e){C.contentEditable=e,C.style.color=e?L.color:L.color,C.style.backgroundColor=e?"white":L.backgroundColor}function g(){E?(E=!1,t.querySelector("#html-button").classList.remove("icon-html-active"),C.innerHTML=C.innerText):(E=!0,t.querySelector("#html-button").classList.add("icon-html-active"),C.innerText=C.innerHTML)}function h(){E&&g();var t=chayns.utils.lang.getMappedLanguage()?chayns.utils.lang.getMappedLanguage():chayns.utils.lang.langStringMap[chayns.env.language],n=chayns.utils.lang.getPrefix()+C.dataset.lang,a=C.innerHTML,o="StringName="+n+"&Text="+encodeURIComponent(a)+"&Language="+t;e.fetch(T,{mode:"cors",method:"post",headers:{Accept:"application/x-www-form-urlencoded","Content-Type":"application/x-www-form-urlencoded"},body:o}).then(function(e){200===e.status?chayns.dialog.alert("","Die &Auml;nderungen wurden erfolgreich gespeichert."):chayns.dialog.alert("","Es ist ein Fehler aufgetreten.")})}function p(){E&&g(),C.innerHTML=L.content}function y(e){switch(e){case"save":h(),f(C);break;case"discard":p(),f(C);break;case"html":g();break;case"h1":case"h2":t.execCommand("formatBlock",!1,e);break;case"p":t.execCommand("formatBlock",!1,e);break;case"insertOrderedList":t.execCommand("insertHTML",!1,'<ol class="list"><li>'+t.getSelection()+"</li></ol>");break;case"insertUnorderedList":t.execCommand("insertHTML",!1,'<ul class="list list--square"><li>'+t.getSelection()+"</li></ul>");break;case"seperator":break;case"CreateLink":var n=prompt("Link-URL:");null!==n&&t.execCommand("CreateLink",!1,n);break;default:t.execCommand(e,!1,null)}}var b=null,C=null,v=!1,E=!1,L={content:null,backgroundColor:null,color:null},T="https://chayns1.tobit.com/TappApi/LangRes/TextString",k=function(){function t(){return chayns!==n}function a(){for(var e=0;e<chayns.env.user.groups.length;e++)if(1===chayns.env.user.groups[e].id)return!0;return!1}function o(e){var t=e.style.paddingTop;t=t?(parseInt(t)+x.TOOLBAR_SIZE).toPixel():x.TOOLBAR_SIZE.toPixel(),e.style.paddingTop=t}function r(e){var t=e.style.paddingTop;t=(parseInt(t)-x.TOOLBAR_SIZE).toPixel(),e.style.paddingTop=t}function l(t){return(t.getBoundingClientRect().top+e.pageYOffset-t.ownerDocument.documentElement.clientTop).toPixel()}function i(t){return(t.getBoundingClientRect().left+e.pageXOffset-t.ownerDocument.documentElement.clientLeft).toPixel()}function s(e){return e.getBoundingClientRect().width.toPixel()}function c(e){for(var t=e;null!=t;){if("body"===t.tagName.toLowerCase())return null;if(t.hasAttribute("data-lang"))return t;t=t.parentNode}return null}function u(e,t){for(var n=t.parentNode;n;){if(n===e)return!0;n=n.parentNode}return!1}function d(e,t,n){chayns.dialog.confirm("",e).then(function(e){1===e?t():n()})}return Number.prototype.toPixel=function(){return this.valueOf().toString()+"px"},{addToolbarMargin:o,removeToolbarMargin:r,getElementTop:l,getElementLeft:i,getElementWidth:s,getEditableParent:c,isChildOf:u,confirmAndCall:d,isChaynsEnvironment:t,isAdmin:a}}(),x=function(){function e(e,n,a){var o=t.createElement(e);if(a&&(o.innerHTML=a),n&&"object"==typeof n)for(var r in n)o.setAttribute(r,n[r]);return o}function n(){var e=t.createElement("div");e.style.display="block",e.style.position="absolute",e.style.backgroundColor="#F2F2F2",e.style.cursor="pointer",e.style.height=r;for(var n=0;n<l.length;n+=1)e.appendChild(a(l[n]));return e}function a(e){var n=t.createElement("button");return"seperator"!==e.name?(e.id&&n.setAttribute("id",e.id),n.style.height=r.toPixel(),n.style.width=r.toPixel(),n.style["float"]=e["float"],n.style.border="none",n.style.backgroundColor="transparent",n.style.cursor="pointer",n.className="icon ce-icon icon-"+e.faClass,n.addEventListener("click",function(){y(e.action)})):(n.style.width="10px",n.style["float"]="left",n.style.border="none",n.style.backgroundColor="transparent"),n}function o(e){b.style.top=k.getElementTop(e),b.style.left=k.getElementLeft(e),b.style.width=k.getElementWidth(e)}var r=30,l=[{name:"Fett",action:"bold",faClass:"bold","float":"left"},{name:"Kursiv",action:"italic",faClass:"italic","float":"left"},{name:"Unterstrichen",action:"underline",faClass:"underline","float":"left"},{name:"seperator"},{name:"Aufz�hlung",action:"insertUnorderedList",faClass:"list-ul","float":"left"},{name:"Nummerierung",action:"insertOrderedList",faClass:"list-ol","float":"left"},{name:"�berschrift 1",action:"h1",faClass:"header-1","float":"left"},{name:"�berschrift 2",action:"h2",faClass:"header-2","float":"left"},{name:"Absatz",action:"p",faClass:"paragraph","float":"left"},{name:"Hyperlink",action:"CreateLink",faClass:"anchor","float":"left"},{name:"seperator"},{name:"HTML anzeigen",action:"html",faClass:"html","float":"left",id:"html-button"},{name:"seperator"},{name:"Speichern",action:"save",faClass:"save","float":"right",id:"save-button"},{name:"Verwerfen",action:"discard",faClass:"discard","float":"right"}];return{createToolbar:n,setToolbarPosition:o,createDomElement:e,TOOLBAR_SIZE:r}}();return{init:a,util:k,dom:x,attachToolbar:d,detachToolbar:f}}(window,document);